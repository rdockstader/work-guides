<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>eCourt Databases</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B" crossorigin="anonymous">
		<link rel="stylesheet" href="/training/shared/css/animate.css">
		<link rel="stylesheet" href="../../../shared/css/style.css">
	</head>
	<body>
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
			<a class="navbar-brand" href="/">SATools</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item">
						<a class="nav-link" href="/training/JustWare/">JustWare</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/training/eCourt/">eCourt</a>
					</li>
					<li class="nav-item">
						<a href="/training/processes/" class="nav-link">Processes</a>
					</li>
					<li class="nav-item">
						<a href="/training/servers/" class="nav-link">Servers</a>
					</li>
				</ul>
			</div>
		</nav>
		<div class="jumbotron jumbotron-fluid">
			<div class="container">
				<h1>Restoring or Creating an eCourt Database</h1>
				<p class="lead">How to restore an existing database, or setup a database for a blank environment</p>
			</div>
		</div>
		<section class="container">
			<div class="row mb-3">
				<div class="col-12">
					<div>
						<p><strong>Jump To:</strong></p>
						<div class="list-group">
							<a class="list-group-item" href="#database-restore-script">Restoring a Database via Script</a>
							<a class="list-group-item" href="#database-restore-manual">Restoring a Database Manually</a>
							<a class="list-group-item" href="#database-new">Creating an Empty Database</a>
						</div>
					</div>
				</div>
			</div>
			<div class="row mb-3">
				<div class="col-12">
					
					<h2 id="database-restore-script">Restoring a Database via Script</h2>
					<ol>
						<li class="pb-5">
							<p>Place the backup file at \\zombie\Sql14Bkp (the file should be a .bak file)</p>
							<img src="img/script_1_network_path.png" alt="network path" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Download and open the eCourt Database Restore script</p>
							<a href="downloads/RestoreScriptEcourt.sql" class="btn btn-primary mb-3" download>Restore Script</a>
							<img src="img/script_2_script.png" alt="script" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>
								Modify the script to have the name of your database as the first parameter. 
								The name should follow the initials_agencyName_case_id structure. I.E. RD_Tulare_18_100. 
								The second parameter should be modified to be the name of your backup file 
							</p>
							<img src="img/script_3_mod_names.png" alt="script parameters" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Run the script. Once it completes your database should be ready for use.</p>
						</li>
					</ol>
				</div>
			</div>
			<div class="row mb-3">
				<div class="col-12">
					<h2 id="database-restore-manual">Restoring a Database Manually</h2>
					<ol>
						<li class="pb-5">
							<p>Place the backup file at \\zombie\Sql14Bkp (file should be a .bak)</p>
						</li>
						<li class="pb-5">
							<p>Launch Microsoft SQL Server Management Studio (SSMS) and connect to the database server</p>
							<img src="img/manual-1-connect.png" alt="connect" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Right click on Databases and select Restore Database</p>
							<img src="img/manual-2-restore-db.png" alt="restore db" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Under Source select device, and use ... to browse to the file location</p>
							<img src="img/manual-3-device.png" alt="select device" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Click the Add Button</p>
							<img src="img/manual-4-add.png" alt="add button" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Select the .bak file that was placed in teh directory in step 1</p>
							<img src="img/manual-5-select-db.png" alt="select db" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Click OK</p>
							<img src="img/manual-6-ok.png" alt="ok button" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Rename the database to Initials_Agency_Case_ID (I.E. RD_Tulare_18_100)</p>
							<img src="img/manual-7-naming.png" alt="database naming" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>
								After the restore is finished, find the database under the Databases
								heading on the object explorer and click the plus to expand the details
							</p>
							<img src="img/manual-8-find-db.png" alt="find db" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Expand Security -&gt; Users</p>
							<img src="img/manual-9-expand.png" alt="expand securty users" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Right click on the dbo user and select properties</p>
							<img src="img/manual-10-dbo.png" alt="dbo properties" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Select Owned Schemas from the Select a Page section</p>
							<img src="img/manual-11-owned-schemas.png" alt="owned schemas" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>select the box next to the ecourt schema</p>
							<img src="img/manual-12-select-ecourt.png" alt="ecourt schema" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>hit OK</p>
							<img src="img/manual-13-ok.png" alt="ok button" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>back in the Users section, right click on the ecourt user and click delete from the drop down</p>
							<img src="img/manual-14-delete-user.png" alt="delete user" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>click no on the prompt to delete the schema</p>
							<img src="img/manual-15-prompt-no.png" alt="no on prompt" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Click OK to delete the user</p>
							<img src="img/manual-16-delete-user.png" alt="delete user" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>
								On the server level in object explorer expand security and logins. 
								If you cant see this on your screen collapse the databases node and 
								it should be directly under that option.
							</p>
							<img src="img/manual-17-server-logins.png" alt="server logins" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>right click on the ecourt user here and click properties</p>
							<img src="img/manual-18-ecourt-properties.png" alt="ecourt properties" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>
								select user mapping from the Select a Page section, and find the newly restored database
								in the list under Users mapped to this login. 
							</p>
							<img src="img/manual-19-user-mapping.png" alt="user mapping" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>
								Check the box next to your database and type ecourt under default schema. Also, check the box for
								db_owner in database role memberships
							</p>
							<img src="img/manual-20-map-user.png" alt="map user" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Click OK</p>
						</li>
						<li class="pb-5">
							<p>Verify the ecourt user shows in the users section on the database level again</p>
							<img src="img/manual-21-verify-user.png" alt="verify user" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Run a query to find all the mail/smtp/host setup to send emails, and replace them with XXXX</p>
							<a href="downloads/ResetSmtpProps.sql" class="btn btn-primary mb-3">Reset SMTP Properties</a>
							<img src="img/manual-22-smtp-query.png" alt="smtp script" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Once the script finishes, your Database should be ready to go</p>
						</li>
					</ol>
				</div>
			</div>
			<div class="row mb-3">
				<div class="col-12">
					<h2 id="database-new">Creating an Empty Database</h2>
					<ol>
						<li class="pb-5">
							<p>Open SQL Server Management Studio (SSMS)</p>
							<img src="img/new-1-ssms.png" alt="" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Connect to the test SQL Server</p>
							<img src="img/new-2-connect.png" alt="" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>In the object explorer, right click Databases and select New Database...</p>
							<img src="img/new-3-new-db.png" alt="" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Name your Database Initials_Test (I.E. RD_Test or RD_Train, RD_Latestest, etc.)</p>
							<img src="img/new-4-naming.png" alt="" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>
								Once the database is created, expand security and logins in the Object Explorer 
								on the Server Level. Right click on the eCourt user and select properties
							</p>
							<img src="img/new-5-server-user.png" alt="" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>
								On the Select a Page menu, select User Mapping. Then find your database in the Users
								Mapped to this Login menu. Then check the box under Map on your database row
							</p>
							<img src="img/new-6-user-mapping.png" alt="" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Type ecourt into the Default Schema and check the box for db_owner in the Database role membership box.</p>
							<img src="img/new-7-user-mapped.png" alt="" class="img-fluid mx-auto d-block rounded">
						</li>
						<li class="pb-5">
							<p>Hit OK. Your database should now be ready for an instance to be installed against it</p>
						</li>
					</ol>
				</div>
			</div>
		</section>
		<script
		  src="https://code.jquery.com/jquery-3.3.1.min.js"
		  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
		  crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js" integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em" crossorigin="anonymous"></script>
		<script src="/training/shared/js/script.js"></script>
	</body>
</html>
